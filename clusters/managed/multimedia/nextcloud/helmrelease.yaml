apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: nextcloud
spec:
  interval: 1h
  chart:
    spec:
      chart: nextcloud
      version: 6.6.4
      sourceRef:
        kind: HelmRepository
        name: nextcloud
        namespace: flux-system
  values:
    deploymentLabels:
      milano.app: nextcloud
      milano.level: managed

    imaginary:
      podLabels:  
        milano.app: nextcloud
        milano.level: managed
      service:
        labels:
          milano.app: nextcloud
          milano.level: managed

    metrics:
      enabled: true
      podLabels:
        milano.app: nextcloud
        milano.level: managed
      serviceMonitor:
        labels:
          milano.app: nextcloud
          milano.level: managed

    persistence:  
      enabled: true
      size: 20Gi
      storageClass: milano-v2

    nextcloud:
      host: drive.trusted.nirmalhk7.com
      existingSecret:
        enabled: true
        secretName: nextcloud-credentials
        usernameKey: nx-username
        passwordKey: nx-password

    internalDatabase:
      enabled: false

    externalDatabase:
      enabled: true
      type: mysql
      database: nextcloud
      host: maria-mariadb-primary.mgd-db.svc.cluster.local:3306
      existingSecret:
        enabled: true
        secretName: nextcloud-credentials
        usernameKey: db-username
        passwordKey: db-password